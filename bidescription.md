# Description BI API
Описание для взаимодействия систем расчета ВI и внешних систем

### Техническое описание взаимодействия систем

1. **BI** - Система расчета анализа
2. **HO** - Транспорт данных между системами
3. **ТТ** - Точки получения информации расчитанной в BI
4. **УС** - Учетная система

Все данные в системе ходят между собой в формате JSON.
## Алгоритм 
1. **ТТ** делает заказ на опредленный анализ согласно справочника анализов (ID аптеки, ID анализа)
2. Посылает запрос в **HO** на расчет (опредленного в справочнике) анализа
3. **BI** получает этот заказ из **HO**
4. **BI** производит расчет на определенное время (сколько времени нужно для расчета ???)
5. **BI** загружает результат в **HO** по API **/bi/load**
7. **TT** забирает свои данные из сервиса по API **/bi/data/{key}** по своему ключу
8. **TT** показывает результаты анализа в УС.

## Описание ключей
|Key|Description|
|----|----|
|**ID_STRUCTURE**|Уникальный ключ **ТТ**
|**ID_ANALYSIS**|Уникальный ключ **Анализа**

## Основные API для BI
|API|Method|Description|
|----|----|----|
|**/bi/task**|GET|Получение запроса для расчета от **ТТ**
|**/bi/load**|POST|Для загрузки данных из системы **BI** 
|**/bi/directory/pharmacy**|GET|Справочник **ТТ**
|**/bi/directory/anlysis**|GET|Справочник анализов в **BI**
|**/bi/data/{key}**|GET|Получение готового расчитанного результата BI по ключу для ТТ

## Формат обмена данных JSON 

### Cправочник ТТ
```
[
  {
    "ID_STRUCTURE":"QWWE-RYRYR-RKOITOT-ROOROR1",
    "NAME_STRUCTURE":"POINT ONE",
    "NAME_CORPORATION":"CORPORATION NAME TWO"
   },
   {......},
   {......}
]
   
```

### Cправочник анализов
```
[
  {
    "ID":"QWWE-RYRYR-RKOITOT-ROOROR1",
    "NAME":"POINT ONE",
   },
   {......},
   {......}
]
   
```


### Данные из системы BI
```
[
  {
    "ID": "string", 
    "ID_STRUCTURE":"QWWE-RYRYR-RKOITOT-ROOROR1",
    "ID_DRUG": "1233445",
    "COUNT":123
   },
   {...},
   {...},
   {...}
]
```

### Запрос для BI на расчет анализа
```
  {
    "ID": "string", 
    "ID_STRUCTURE":"QWWE-RYRYR-RKOITOT-ROOROR1",
    "NAME_STRUCTURE":"Name TT",
    "ID_ANALYSIS":1,
    "DUE_DATE":"01-20-2016T02:04:00"
   }
```

## Вопросы и уточнения
1. Как быть с существующими требованиями по формату к выгружаемым данным
2. Расписание загрузки и выгрузки данными
3. Ведение лога по загрузке и выгрузке
